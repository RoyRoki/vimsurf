(()=>{var e={130:function(e,t,n){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return r};const r={core:(0,o(n(270)).default)()}},184:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.scrollActions=void 0,t.default=function(){return t.scrollActions};const o=n(866);t.scrollActions={scroll:({amount:e})=>{if(void 0!==e&&!(0,o.validateScrollAmount)(e))return;const t=null!=e?e:(0,o.getScrollAmount)();window.scrollBy(0,t)},jumpTop:()=>{window.scrollTo(0,0)},jumpBottom:()=>{window.scrollTo(0,document.body.scrollHeight)}}},199:(e,t)=>{"use strict";function n(e){const t=[];if("object"!=typeof e||null===e||Array.isArray(e))return t.push({path:"",message:"manifest must be an object"}),{valid:!1,errors:t};for(const n of["name","version","commands"])n in e||t.push({path:n,message:"is required"});"name"in e&&"string"!=typeof e.name&&t.push({path:"name",message:"must be a string"}),"version"in e&&("string"!=typeof e.version?t.push({path:"version",message:"must be a string"}):/^\d+\.\d+\.\d+$/.test(e.version)||t.push({path:"version",message:"must match semver (x.y.z)"})),"priority"in e&&(Number.isInteger(e.priority)?e.priority<0&&t.push({path:"priority",message:"must be ≥ 0"}):t.push({path:"priority",message:"must be an integer"}));const n=new Set(["normal","insert","visual","operator-pending"]);if("modes"in e&&(Array.isArray(e.modes)?e.modes.forEach((e,o)=>{"string"!=typeof e?t.push({path:`modes[${o}]`,message:"must be a string"}):n.has(e)||t.push({path:`modes[${o}]`,message:`must be one of ${[...n].join(", ")}`})}):t.push({path:"modes",message:"must be an array"})),"commands"in e&&(Array.isArray(e.commands)?0===e.commands.length?t.push({path:"commands",message:"must have at least one entry"}):e.commands.forEach((e,n)=>{const o=`commands[${n}]`;if("object"!=typeof e||null===e||Array.isArray(e))t.push({path:o,message:"must be an object"});else{for(const n of["key","action"])n in e||t.push({path:`${o}.${n}`,message:"is required"});"key"in e&&"string"!=typeof e.key&&t.push({path:`${o}.key`,message:"must be a string"}),"action"in e&&"string"!=typeof e.action&&t.push({path:`${o}.action`,message:"must be a string"}),"args"in e&&("object"!=typeof e.args||null===e.args||Array.isArray(e.args))&&t.push({path:`${o}.args`,message:"must be an object"}),"modes"in e&&(Array.isArray(e.modes)?e.modes.forEach((e,n)=>{"string"!=typeof e&&t.push({path:`${o}.modes[${n}]`,message:"must be a string"})}):t.push({path:`${o}.modes`,message:"must be an array"})),"priority"in e&&(Number.isInteger(e.priority)?e.priority<0&&t.push({path:`${o}.priority`,message:"must be ≥ 0"}):t.push({path:`${o}.priority`,message:"must be an integer"}))}}):t.push({path:"commands",message:"must be an array"})),"ui"in e)if("object"!=typeof e.ui||null===e.ui||Array.isArray(e.ui))t.push({path:"ui",message:"must be an object"});else{if("slot"in e.ui){const n=e.ui.slot;["overlay","sidebar","toolbar","statusbar"].includes(n)||t.push({path:"ui.slot",message:"must be one of overlay, sidebar, toolbar, statusbar"})}"trigger"in e.ui&&"string"!=typeof e.ui.trigger&&t.push({path:"ui.trigger",message:"must be a string"})}return{valid:0===t.length,errors:t}}Object.defineProperty(t,"__esModule",{value:!0}),t.validatePlugin=n,t.validatePlugins=function(e){const t=[],o=[];for(const r of e){const{valid:e,errors:s}=n(r);e?t.push(r):o.push({manifest:r,errors:s})}return{validPlugins:t,invalid:o}}},270:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return Object.assign({},o.scrollActions)};const o=n(184)},275:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LocalKeys=void 0,t.LocalKeys={scrollAmount:"scrollAmount"}},363:function(e,t,n){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),(0,o(n(748)).default)()},411:(e,t,n)=>{var o;!function(r,s){if(r){for(var i,a={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},u={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},c={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},l={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},d=1;d<20;++d)a[111+d]="f"+d;for(d=0;d<=9;++d)a[d+96]=d.toString();b.prototype.bind=function(e,t,n){var o=this;return e=e instanceof Array?e:[e],o._bindMultiple.call(o,e,t,n),o},b.prototype.unbind=function(e,t){return this.bind.call(this,e,function(){},t)},b.prototype.trigger=function(e,t){var n=this;return n._directMap[e+":"+t]&&n._directMap[e+":"+t]({},e),n},b.prototype.reset=function(){var e=this;return e._callbacks={},e._directMap={},e},b.prototype.stopCallback=function(e,t){if((" "+t.className+" ").indexOf(" mousetrap ")>-1)return!1;if(v(t,this.target))return!1;if("composedPath"in e&&"function"==typeof e.composedPath){var n=e.composedPath()[0];n!==e.target&&(t=n)}return"INPUT"==t.tagName||"SELECT"==t.tagName||"TEXTAREA"==t.tagName||t.isContentEditable},b.prototype.handleKey=function(){return this._handleKey.apply(this,arguments)},b.addKeycodes=function(e){for(var t in e)e.hasOwnProperty(t)&&(a[t]=e[t]);i=null},b.init=function(){var e=b(s);for(var t in e)"_"!==t.charAt(0)&&(b[t]=function(t){return function(){return e[t].apply(e,arguments)}}(t))},b.init(),r.Mousetrap=b,e.exports&&(e.exports=b),void 0===(o=function(){return b}.call(t,n,t,e))||(e.exports=o)}function f(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)}function p(e){if("keypress"==e.type){var t=String.fromCharCode(e.which);return e.shiftKey||(t=t.toLowerCase()),t}return a[e.which]?a[e.which]:u[e.which]?u[e.which]:String.fromCharCode(e.which).toLowerCase()}function m(e,t){return e.sort().join(",")===t.sort().join(",")}function h(e){return"shift"==e||"ctrl"==e||"alt"==e||"meta"==e}function y(e,t,n){return n||(n=function(){if(!i)for(var e in i={},a)e>95&&e<112||a.hasOwnProperty(e)&&(i[a[e]]=e);return i}()[e]?"keydown":"keypress"),"keypress"==n&&t.length&&(n="keydown"),n}function g(e,t){var n,o,r,s=[];for(n=function(e){return"+"===e?["+"]:(e=e.replace(/\+{2}/g,"+plus")).split("+")}(e),r=0;r<n.length;++r)o=n[r],l[o]&&(o=l[o]),t&&"keypress"!=t&&c[o]&&(o=c[o],s.push("shift")),h(o)&&s.push(o);return{key:o,modifiers:s,action:t=y(o,s,t)}}function v(e,t){return null!==e&&e!==s&&(e===t||v(e.parentNode,t))}function b(e){var t=this;if(e=e||s,!(t instanceof b))return new b(e);t.target=e,t._callbacks={},t._directMap={};var n,o={},r=!1,i=!1,a=!1;function u(e){e=e||{};var t,n=!1;for(t in o)e[t]?n=!0:o[t]=0;n||(a=!1)}function c(e,n,r,s,i,a){var u,c,l=[],d=r.type;if(!t._callbacks[e])return[];for("keyup"==d&&h(e)&&(n=[e]),u=0;u<t._callbacks[e].length;++u)if(c=t._callbacks[e][u],(s||!c.seq||o[c.seq]==c.level)&&d==c.action&&("keypress"==d&&!r.metaKey&&!r.ctrlKey||m(n,c.modifiers))){var f=!s&&c.combo==i,p=s&&c.seq==s&&c.level==a;(f||p)&&t._callbacks[e].splice(u,1),l.push(c)}return l}function l(e,n,o,r){t.stopCallback(n,n.target||n.srcElement,o,r)||!1===e(n,o)&&(function(e){e.preventDefault?e.preventDefault():e.returnValue=!1}(n),function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}(n))}function d(e){"number"!=typeof e.which&&(e.which=e.keyCode);var n=p(e);n&&("keyup"!=e.type||r!==n?t.handleKey(n,function(e){var t=[];return e.shiftKey&&t.push("shift"),e.altKey&&t.push("alt"),e.ctrlKey&&t.push("ctrl"),e.metaKey&&t.push("meta"),t}(e),e):r=!1)}function y(e,s,i,d,f){t._directMap[e+":"+i]=s;var m,h=(e=e.replace(/\s+/g," ")).split(" ");h.length>1?function(e,t,s,i){function c(t){return function(){a=t,++o[e],clearTimeout(n),n=setTimeout(u,1e3)}}function d(t){l(s,t,e),"keyup"!==i&&(r=p(t)),setTimeout(u,10)}o[e]=0;for(var f=0;f<t.length;++f){var m=f+1===t.length?d:c(i||g(t[f+1]).action);y(t[f],m,i,e,f)}}(e,h,s,i):(m=g(e,i),t._callbacks[m.key]=t._callbacks[m.key]||[],c(m.key,m.modifiers,{type:m.action},d,e,f),t._callbacks[m.key][d?"unshift":"push"]({callback:s,modifiers:m.modifiers,action:m.action,seq:d,level:f,combo:e}))}t._handleKey=function(e,t,n){var o,r=c(e,t,n),s={},d=0,f=!1;for(o=0;o<r.length;++o)r[o].seq&&(d=Math.max(d,r[o].level));for(o=0;o<r.length;++o)if(r[o].seq){if(r[o].level!=d)continue;f=!0,s[r[o].seq]=1,l(r[o].callback,n,r[o].combo,r[o].seq)}else f||l(r[o].callback,n,r[o].combo);var p="keypress"==n.type&&i;n.type!=a||h(e)||p||u(s),i=f&&"keydown"==n.type},t._bindMultiple=function(e,t,n){for(var o=0;o<e.length;++o)y(e[o],t,n)},f(e,"keypress",d),f(e,"keydown",d),f(e,"keyup",d)}}("undefined"!=typeof window?window:null,"undefined"!=typeof window?document:null)},640:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.findConflicts=function(e){var t;const n=new Map;for(const o of e)for(const e of o.commands){const r=null!==(t=e.modes)&&void 0!==t?t:["normal"];for(const t of r){const r=`${t}:${e.key}`;n.has(r)||n.set(r,new Set),n.get(r).add(o.name)}}const o=[];for(const[e,t]of n)if(t.size>1){const[n,r]=e.split(":");o.push({mode:n,key:r,plugins:Array.from(t)})}return o}},657:(e,t,n)=>{var o={"./default.json":833};function r(e){var t=s(e);return n(t)}function s(e){if(!n.o(o,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return o[e]}r.keys=function(){return Object.keys(o)},r.resolve=s,e.exports=r,r.id=657},675:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initModeService=function(){document.addEventListener("focusin",e=>{const t=e.target;r=t.matches("input, textarea, [contenteditable]")?o.Modes.Insert:o.Modes.Normal})},t.getCurrentMode=function(){return r},t.setCurrentMode=function(e){r!==e&&(r=e,document.dispatchEvent(new CustomEvent("vimsurf:modeChanged",{detail:{mode:e}})))};const o=n(936);let r=o.Modes.Normal},745:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.flattenActionMaps=function(e){return Object.entries(e).reduce((e,[t,n])=>{for(const[o,r]of Object.entries(n))e[`${t}.${o}`]=r;return e},{})}},748:function(e,t,n){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){(0,s.initModeService)(),(0,i.initScrollService)();const e=(0,a.default)();new r.PluginManager(e).init().then(()=>console.log("Vimsurf fully initialized!")).catch(e=>console.error("Failed to initialize plugins:",e))};const r=n(753),s=n(675),i=n(866),a=o(n(130))},753:function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,s){function i(e){try{u(o.next(e))}catch(e){s(e)}}function a(e){try{u(o.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,a)}u((o=o.apply(e,t||[])).next())})},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PluginManager=void 0;const s=r(n(411)),i=n(986),a=n(675),u=n(640),c=n(745),l=n(199);t.PluginManager=class{constructor(e){this.namedMaps=e,this.manifests=[],this.actionMap=(0,c.flattenActionMaps)(e)}init(){return o(this,void 0,void 0,function*(){yield this.loadAndValidate(),this.resolveConflicts(),this.bindAll(),console.log(`[PluginManager] Loaded plugins: ${this.manifests.map(e=>e.name).join(", ")}`)})}loadAndValidate(){return o(this,void 0,void 0,function*(){const e=[...yield this.loadBuiltIn(),...yield this.loadUser()],{validPlugins:t,invalid:n}=(0,l.validatePlugins)(e);n.forEach(({manifest:e,errors:t})=>console.error("[PluginManager] Invalid plugin",e,t)),this.manifests=t})}resolveConflicts(){(0,u.findConflicts)(this.manifests).forEach(({mode:e,key:t,plugins:n},o)=>{console.warn(`[PluginManager] Conflict #${o+1} on key="${t}" in mode="${e}" among:`,n),n.slice(1).forEach(()=>{s.default.unbind(t)})})}bindAll(){s.default.reset(),this.manifests.forEach(e=>{e.commands.forEach(e=>{const t=e.key;s.default.bind(t,t=>{t.preventDefault();const n=(0,a.getCurrentMode)();if(e.modes&&!e.modes.includes(n))return;const o=this.actionMap[e.action];o?o(e.args):console.warn(`[PluginManager] No handler for action "${e.action}"`)})})})}loadBuiltIn(){return o(this,void 0,void 0,function*(){try{const e=n(657),t=e.keys();return console.debug("[PluginManager] Discovered plugin files:",t),t.map(t=>{const n=e(t);return console.debug(`[PluginManager] Loaded plugin module for ${t}:`,n),n})}catch(e){return console.warn("[PluginManager] Failed to load built-in plugins via context",e),[]}})}loadUser(){return new Promise(e=>{chrome.storage.sync.get(i.AppConstants.userPluginsKey,t=>{const n=[];(t[i.AppConstants.userPluginsKey]||[]).forEach(e=>{try{n.push(JSON.parse(atob(e)))}catch(e){}}),e(n)})})}}},833:e=>{"use strict";e.exports=JSON.parse('{"name":"defaultScroll","version":"0.1.0","priority":1,"commands":[{"key":"j","action":"core.scroll","args":{"amount":40},"modes":["normal"]},{"key":"k","action":"core.scroll","args":{"amount":-40},"modes":["normal"]}]}')},852:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AppUnits=void 0,t.AppUnits={scrollAmount:40}},866:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initScrollService=function(){chrome.storage.sync.get(r.LocalKeys.scrollAmount,e=>{"number"==typeof e.scrollAmount&&i(e.scrollAmount)&&(s=e.scrollAmount)})},t.getScrollAmount=function(){return s},t.validateScrollAmount=i;const o=n(852),r=n(275);let s=o.AppUnits.scrollAmount;function i(e){return-9999<e&&e<9999}},936:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Modes=void 0,t.Modes={Normal:"normal",Insert:"insert",Visual:"visual"}},986:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AppConstants=void 0,t.AppConstants={buildInPlugins:["default.json"],userPluginsKey:"userPlugins"}}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var s=t[o]={exports:{}};return e[o].call(s.exports,s,s.exports,n),s.exports}n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n(363)})();